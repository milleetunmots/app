require 'rails_helper'

RSpec.describe Typeform::InitialFormService do
  let!(:child) { FactoryBot.create(:child)}


  describe 'webhooks' do
    it 'updating child_support with typeform data' do
      params = { "event_id": "01GA8VN3NDEWJYYWR5YSBWPTGG", "event_type": "form_response", "form_response": { "form_id": "XdWSv2hR", "token": "3rb2qiiarzoeecrhs9yt3rb2qiph84er", "landed_at": "2022-08-12T11:03:50Z", "submitted_at": "2022-08-12T11:04:58Z", "hidden": { "child_support_id": child.child_support.id }, "definition": { "id": "XdWSv2hR", "title": "Questionnaire initial 1001mots V2", "fields": [ { "id": "typeform_name_id", "ref": "e9f81869-6960-4f8b-b039-a94c12b2b5cc", "type": "long_text", "title": "*Quel est le pr√©nom de votre enfant inscrit √† 1001mots ?*", "properties": {} }, { "id": "1Oomu9WSahmD", "ref": "6ffdf209-d13a-42b2-94ce-ab6ac26af5e1", "type": "picture_choice", "title": "*Selon vous, qu'est-ce qui est le plus utile pour aider **{{field:e9f81869-6960-4f8b-b039-a94c12b2b5cc}}** √† parler ? *ü§î", "properties": {}, "allow_multiple_selections": true, "choices": [ { "id": "zJv5xTbCqJ1X", "label": "Quand je lui parle" }, { "id": "F6Iax9oLBBkx", "label": "Quand je lui chante des comptines" }, { "id": "GxuPAXJ7r2Au", "label": "Quand on joue ensemble" }, { "id": "S01UbvCGpJlt", "label": "Quand on regarde un livre ensemble" } ] }, { "id": "typeform_child_count_id", "ref": "bdd39145-e370-454e-9431-c08f798122f2", "type": "multiple_choice", "title": "*Combien d'enfants avez-vous ?*", "properties": {}, "choices": [ { "id": "RyMoJFmMZs3b", "label": "1" }, { "id": "xFR3EbFYQvXT", "label": "2" }, { "id": "0JGTJyorsigG", "label": "3" }, { "id": "m8ARDLC9L4ja", "label": "4" }, { "id": "5Pm78teW40p2", "label": "5" }, { "id": "onIHtEndDPi6", "label": "Plus de 5" } ] }, { "id": "typeform_already_working_with_id", "ref": "7f6ff798-a790-4942-9fc1-ca00add15344", "type": "multiple_choice", "title": "*Avez-vous d√©j√† √©t√© accompagn√©(e) par 1001mots pour un(e) autre de vos enfants ?*", "properties": {}, "choices": [ { "id": "6DJI8PvZV6li", "label": "Non" }, { "id": "5qOFtlhgVL4G", "label": "Oui" } ] }, { "id": "typeform_books_quantity_id", "ref": "cd2ec817-e02c-4722-aa20-7061133cc9c8", "type": "multiple_choice", "title": "*Combien avez-vous de livre(s) sp√©cialement pour **{{field:e9f81869-6960-4f8b-b039-a94c12b2b5cc}}** √† la maison ?*", "properties": {}, "choices": [ { "id": "fIIg7irb0bMv", "label": "0" }, { "id": "IU0O5Q36QNDe", "label": "1" }, { "id": "RvoBiOMhJqcD", "label": "2" }, { "id": "l83E7M3WHRtq", "label": "3" }, { "id": "5bX3d4r4hR5S", "label": "4" }, { "id": "G9HUMOyW8bHO", "label": "5" }, { "id": "K1F6PlNeG4TA", "label": "6" }, { "id": "SnsvvXyFmnCI", "label": "7" }, { "id": "re678FhHgZYB", "label": "8" }, { "id": "XrDUZTnl9Otj", "label": "9" }, { "id": "goGeKQvfo0HY", "label": "10" }, { "id": "QPXIzrZBJqLh", "label": "Entre 11 et 20" }, { "id": "0eENVZNMQH8h", "label": "Plus de 20" } ] }, { "id": "typeform_most_present_parent_id", "ref": "538fd9bd-435b-4634-954a-dd043c44c983", "type": "multiple_choice", "title": "*Qui passe le plus de temps avec **{{field:e9f81869-6960-4f8b-b039-a94c12b2b5cc}}** dans la journ√©e en semaine ?*", "properties": {}, "allow_other_choice": true, "choices": [ { "id": "X3OTdqKzGhi6", "label": "Moi" }, { "id": "szUamCC1wES7", "label": "Plut√¥t l'autre parent" }, { "id": "kMP3acq8PMF4", "label": "Les deux pareil !" }, { "id": "gN78yiVLN8If", "label": "Une assistante maternelle, nourrice" }, { "id": "fi0v4LCTm8UZ", "label": "Le personnel de la cr√®che" }, { "id": "uku3QlRYEpOl", "label": "Un autre membre de la famille" } ] }, { "id": "typeform_other_parent_phone_id", "ref": "80e9d338-af20-400d-91bd-9f7d637b77eb", "type": "short_text", "title": "*Si vous ne l'avez pas d√©j√† fait, vous pouvez nous donner le num√©ro de l'autre parent ici :*", "properties": {} }, { "id": "typeform_degree_id", "ref": "19ea80d8-6409-407f-b28d-e1d3fc1658c6", "type": "multiple_choice", "title": "*Quel est le dernier dipl√¥me que vous avez obtenu ?*", "properties": {}, "allow_other_choice": true, "choices": [ { "id": "FqdeBEgdo49l", "label": "Sans dipl√¥me" }, { "id": "CeVO6QEgAUam", "label": "Brevet" }, { "id": "FnWt3y9OeVej", "label": "BEP ou CAP" }, { "id": "dqiaG4jcp6KJ", "label": "Bac" }, { "id": "T16alGALfs5R", "label": "Bac+1" }, { "id": "piMjOL0qHNFb", "label": "Bac+2" }, { "id": "LtEtvnz3WXye", "label": "Bac+3" }, { "id": "CrxxrsLwGayg", "label": "Bac+4" }, { "id": "FmnhX20wddXo", "label": "Bac+5 et plus" } ] }, { "id": "typeform_degree_in_france_id", "ref": "3a6b26a4-91d0-45bd-8591-2c7878f3a0fb", "type": "multiple_choice", "title": "*Dans quel pays avez-vous obtenu votre dipl√¥me ?*", "properties": {}, "choices": [ { "id": "i7nYJquHdaTO", "label": "France" }, { "id": "UE6TnYWzguH4", "label": "Autre" } ] }, { "id": "typeform_other_parent_degree_id", "ref": "84ca2645-94d5-49d9-8d76-0716a167dc2c", "type": "multiple_choice", "title": "*Quel est le dernier dipl√¥me que l'autre parent a obtenu ?*", "properties": {}, "allow_other_choice": true, "choices": [ { "id": "retKZMPIp8dJ", "label": "Sans dipl√¥me" }, { "id": "NbikGWIwTvug", "label": "Brevet" }, { "id": "ZshskRf5Aqcm", "label": "BEP ou CAP" }, { "id": "7wSU5vXgyYsL", "label": "Bac" }, { "id": "DYyMXx6e6AAu", "label": "Bac+1" }, { "id": "9FHqQLTOSK6S", "label": "Bac+2" }, { "id": "ToVnlDy5Srmj", "label": "Bac+3" }, { "id": "204NK3JuiGfH", "label": "Bac+4" }, { "id": "InUsw7bTEbJS", "label": "Bac+5 et plus" } ] }, { "id": "typeform_other_parent_degree_in_france_id", "ref": "9d784b83-4f4c-4310-ae6c-b7596e7a25e9", "type": "multiple_choice", "title": "*Dans quel pays l'autre parent a-t-il(elle) obtenu son dipl√¥me ?*", "properties": {}, "choices": [ { "id": "qvirwAVfx9Qb", "label": "France" }, { "id": "0KGR4V5Regoz", "label": "Autre" } ] }, { "id": "typeform_reading_frequency_id", "ref": "f133e06f-c46f-43e2-a903-5f696fba8c9f", "type": "multiple_choice", "title": "*La semaine derni√®re, quels jours avez-vous regard√© un livre avec **{{field:e9f81869-6960-4f8b-b039-a94c12b2b5cc}}** ? *üìñ ", "properties": {}, "allow_multiple_selections": true, "choices": [ { "id": "jwSWyDfwiXfh", "label": "Aucun" }, { "id": "7Dk1pOfsOhKX", "label": "Lundi" }, { "id": "h5KKIz3vqktz", "label": "Mardi" }, { "id": "m9BrNlG2kCdJ", "label": "Mercredi" }, { "id": "2oip33EZHOJR", "label": "Jeudi" }, { "id": "rZERvDYpCQho", "label": "Vendredi" }, { "id": "hbItaHjtKKyH", "label": "Samedi" }, { "id": "pXw7mk5sn3LF", "label": "Dimanche" } ] }, { "id": "typeform_tv_frequency_id", "ref": "764d77ef-a8b4-490a-9bcc-31851208391b", "type": "multiple_choice", "title": "*La semaine derni√®re quels jours **{{field:e9f81869-6960-4f8b-b039-a94c12b2b5cc}}** a regard√© la TV ou le t√©l√©phone plus de 5 minutes ?* üì∫üì≥", "properties": {}, "allow_multiple_selections": true, "choices": [ { "id": "opYbV5sVcvKA", "label": "Aucun" }, { "id": "Pqef2GoXYgBs", "label": "Lundi" }, { "id": "asjXiZbPJuyU", "label": "Mardi" }, { "id": "j9WCz5UsPK84", "label": "Mercredi" }, { "id": "HbG4Bz6Dgzoc", "label": "Jeudi" }, { "id": "LMcMehnPCn7P", "label": "Vendredi" }, { "id": "tBZso5BRas8d", "label": "Samedi" }, { "id": "jLa4l0fPsmJ1", "label": "Dimanche" } ] }, { "id": "typeform_is_bilingual_id", "ref": "4d67f3e1-5e72-482e-97e9-d046a383a16f", "type": "multiple_choice", "title": "*Parlez-vous d'autres langues que le fran√ßais avec **{{field:e9f81869-6960-4f8b-b039-a94c12b2b5cc}}** ?*", "properties": {}, "choices": [ { "id": "gpkz3cDa6fYz", "label": "Oui" }, { "id": "cUaDy4om0ZdN", "label": "Non" } ] }, { "id": "typeform_help_my_child_to_learn_id_important_id", "ref": "da960598-66e9-4a86-ae80-d7f492b48878", "type": "multiple_choice", "title": "Aider mon enfant √† apprendre est important pour moi en ce moment", "properties": {}, "choices": [ { "id": "bwYh4RJY9NZN", "label": "D'accord" }, { "id": "pisoc8khZ8Ct", "label": "Pas d'accord" }, { "id": "w3L04oyxeWb7", "label": "Je ne sais pas" } ] }, { "id": "typeform_would_like_to_do_more_id", "ref": "8dcf90e4-1d26-46e6-876f-1fd664eb927d", "type": "multiple_choice", "title": "J'aimerais en faire encore plus pour l'aider √† apprendre", "properties": {}, "choices": [ { "id": "p2ts2CXR7p4y", "label": "D'accord" }, { "id": "oK4qCPCRT1bD", "label": "Pas d'accord" }, { "id": "gdfTWMDHCeqm", "label": "Je ne sais pas" } ] }, { "id": "typeform_would_like_to_receive_advices_id", "ref": "c72278d9-cf0d-4ef9-898b-b744b5a6e979", "type": "multiple_choice", "title": "J'aimerais recevoir des conseils, des id√©es ou de l'aide pour apprendre des choses √† mon enfant", "properties": {}, "choices": [ { "id": "oC48itSLTcNH", "label": "D'accord" }, { "id": "mnjkv2W1aGwg", "label": "Pas d'accord" }, { "id": "QWtMA4TdyBpL", "label": "Je ne sais pas" } ] }, { "id": "typeform_parental_contexts_id", "ref": "ee0235d3-8ba0-4f7f-a98e-cabc0bfea661", "type": "multiple_choice", "title": "Est-ce que vous vous reconnaissez dans un ou plusieurs de ces parents ?", "properties": {}, "allow_multiple_selections": true, "choices": [ { "id": "Mx9aIY9e4tM8", "ref": "2f7e60fe-e468-4780-92cb-12785fb6b113", "label": "C‚Äôest mon premier enfant." }, { "id": "krp4H040QdLk", "ref": "f465c57d-655f-4840-a226-9b69e1ceb360", "label": "Je suis en France depuis moins de 10 ans." }, { "id": "jb1BSV16C3bV", "ref": "ac642549-7c62-4577-9641-55cbeade2818", "label": "J‚Äô√©l√®ve mes enfants seul.e." }, { "id": "wL8YeET0A520", "ref": "8c94e6c0-66f0-4fbc-96b5-45502ed0d2f7", "label": "Un de mes enfants a (eu) des retards de langage." }, { "id": "UwCooO8mXvIm", "ref": "20a688da-941d-4db7-8cec-14d79efe5d60", "label": "Mon enfant est pr√©matur√© ou en situation de handicap." }, { "id": "BjoWCPwzDeIO", "ref": "0a0b11c5-22f0-4b14-ba50-697d987fe295", "label": "J‚Äôai d√©j√† beaucoup d‚Äôexp√©rience en tant que parent." }, { "id": "ogcNlDMddiw9", "ref": "d7ff5ecf-d92d-43a5-b5c0-276adf3713c3", "label": "Non." } ] } ] }, "answers": [ { "type": "text", "text": "Prenom", "field": { "id": "typeform_name_id", "type": "long_text", "ref": "e9f81869-6960-4f8b-b039-a94c12b2b5cc" } }, { "type": "choices", "choices": { "labels": [ "Quand je lui parle", "Quand je lui chante des comptines", "Quand on joue ensemble", "Quand on regarde un livre ensemble" ] }, "field": { "id": "1Oomu9WSahmD", "type": "picture_choice", "ref": "6ffdf209-d13a-42b2-94ce-ab6ac26af5e1" } }, { "type": "choice", "choice": { "label": "2" }, "field": { "id": "typeform_child_count_id", "type": "multiple_choice", "ref": "bdd39145-e370-454e-9431-c08f798122f2" } }, { "type": "choice", "choice": { "label": "Oui" }, "field": { "id": "typeform_already_working_with_id", "type": "multiple_choice", "ref": "7f6ff798-a790-4942-9fc1-ca00add15344" } }, { "type": "choice", "choice": { "label": "2" }, "field": { "id": "typeform_books_quantity_id", "type": "multiple_choice", "ref": "cd2ec817-e02c-4722-aa20-7061133cc9c8" } }, { "type": "choice", "choice": { "label": "Les deux pareil !" }, "field": { "id": "typeform_most_present_parent_id", "type": "multiple_choice", "ref": "538fd9bd-435b-4634-954a-dd043c44c983" } }, { "type": "text", "text": "0677889922", "field": { "id": "typeform_other_parent_phone_id", "type": "short_text", "ref": "80e9d338-af20-400d-91bd-9f7d637b77eb" } }, { "type": "choice", "choice": { "label": "Bac" }, "field": { "id": "typeform_degree_id", "type": "multiple_choice", "ref": "19ea80d8-6409-407f-b28d-e1d3fc1658c6" } }, { "type": "choice", "choice": { "label": "France" }, "field": { "id": "typeform_degree_in_france_id", "type": "multiple_choice", "ref": "3a6b26a4-91d0-45bd-8591-2c7878f3a0fb" } }, { "type": "choice", "choice": { "label": "Bac" }, "field": { "id": "typeform_other_parent_degree_id", "type": "multiple_choice", "ref": "84ca2645-94d5-49d9-8d76-0716a167dc2c" } }, { "type": "choice", "choice": { "label": "Autre" }, "field": { "id": "typeform_other_parent_degree_in_france_id", "type": "multiple_choice", "ref": "9d784b83-4f4c-4310-ae6c-b7596e7a25e9" } }, { "type": "choices", "choices": { "labels": [ "Aucun" ] }, "field": { "id": "typeform_reading_frequency_id", "type": "multiple_choice", "ref": "f133e06f-c46f-43e2-a903-5f696fba8c9f" } }, { "type": "choices", "choices": { "labels": [ "Lundi", "Mardi", "Mercredi" ] }, "field": { "id": "typeform_tv_frequency_id", "type": "multiple_choice", "ref": "764d77ef-a8b4-490a-9bcc-31851208391b" } }, { "type": "choice", "choice": { "label": "Oui" }, "field": { "id": "typeform_is_bilingual_id", "type": "multiple_choice", "ref": "4d67f3e1-5e72-482e-97e9-d046a383a16f" } }, { "type": "choice", "choice": { "label": "D'accord" }, "field": { "id": "typeform_help_my_child_to_learn_id_important_id", "type": "multiple_choice", "ref": "da960598-66e9-4a86-ae80-d7f492b48878" } }, { "type": "choice", "choice": { "label": "D'accord" }, "field": { "id": "typeform_would_like_to_do_more_id", "type": "multiple_choice", "ref": "8dcf90e4-1d26-46e6-876f-1fd664eb927d" } }, { "type": "choice", "choice": { "label": "D'accord" }, "field": { "id": "typeform_would_like_to_receive_advices_id", "type": "multiple_choice", "ref": "c72278d9-cf0d-4ef9-898b-b744b5a6e979" } }, { "type": "choices", "choices": { "labels": [ "C‚Äôest mon premier enfant.", "Je suis en France depuis moins de 10 ans." ] }, "field": { "id": "typeform_parental_contexts_id", "type": "multiple_choice", "ref": "ee0235d3-8ba0-4f7f-a98e-cabc0bfea661" } } ] }, "typeform": { "event_id": "01GA8VN3NDEWJYYWR5YSBWPTGG", "event_type": "form_response", "form_response": { "form_id": "XdWSv2hR", "token": "3rb2qiiarzoeecrhs9yt3rb2qiph84er", "landed_at": "2022-08-12T11:03:50Z", "submitted_at": "2022-08-12T11:04:58Z", "hidden": { "child_support_id": "38" }, "definition": { "id": "XdWSv2hR", "title": "Questionnaire initial 1001mots V2", "fields": [ { "id": "typeform_name_id", "ref": "e9f81869-6960-4f8b-b039-a94c12b2b5cc", "type": "long_text", "title": "*Quel est le pr√©nom de votre enfant inscrit √† 1001mots ?*", "properties": {} }, { "id": "1Oomu9WSahmD", "ref": "6ffdf209-d13a-42b2-94ce-ab6ac26af5e1", "type": "picture_choice", "title": "*Selon vous, qu'est-ce qui est le plus utile pour aider **{{field:e9f81869-6960-4f8b-b039-a94c12b2b5cc}}** √† parler ? *ü§î", "properties": {}, "allow_multiple_selections": true, "choices": [ { "id": "zJv5xTbCqJ1X", "label": "Quand je lui parle" }, { "id": "F6Iax9oLBBkx", "label": "Quand je lui chante des comptines" }, { "id": "GxuPAXJ7r2Au", "label": "Quand on joue ensemble" }, { "id": "S01UbvCGpJlt", "label": "Quand on regarde un livre ensemble" } ] }, { "id": "typeform_child_count_id", "ref": "bdd39145-e370-454e-9431-c08f798122f2", "type": "multiple_choice", "title": "*Combien d'enfants avez-vous ?*", "properties": {}, "choices": [ { "id": "RyMoJFmMZs3b", "label": "1" }, { "id": "xFR3EbFYQvXT", "label": "2" }, { "id": "0JGTJyorsigG", "label": "3" }, { "id": "m8ARDLC9L4ja", "label": "4" }, { "id": "5Pm78teW40p2", "label": "5" }, { "id": "onIHtEndDPi6", "label": "Plus de 5" } ] }, { "id": "typeform_already_working_with_id", "ref": "7f6ff798-a790-4942-9fc1-ca00add15344", "type": "multiple_choice", "title": "*Avez-vous d√©j√† √©t√© accompagn√©(e) par 1001mots pour un(e) autre de vos enfants ?*", "properties": {}, "choices": [ { "id": "6DJI8PvZV6li", "label": "Non" }, { "id": "5qOFtlhgVL4G", "label": "Oui" } ] }, { "id": "typeform_books_quantity_id", "ref": "cd2ec817-e02c-4722-aa20-7061133cc9c8", "type": "multiple_choice", "title": "*Combien avez-vous de livre(s) sp√©cialement pour **{{field:e9f81869-6960-4f8b-b039-a94c12b2b5cc}}** √† la maison ?*", "properties": {}, "choices": [ { "id": "fIIg7irb0bMv", "label": "0" }, { "id": "IU0O5Q36QNDe", "label": "1" }, { "id": "RvoBiOMhJqcD", "label": "2" }, { "id": "l83E7M3WHRtq", "label": "3" }, { "id": "5bX3d4r4hR5S", "label": "4" }, { "id": "G9HUMOyW8bHO", "label": "5" }, { "id": "K1F6PlNeG4TA", "label": "6" }, { "id": "SnsvvXyFmnCI", "label": "7" }, { "id": "re678FhHgZYB", "label": "8" }, { "id": "XrDUZTnl9Otj", "label": "9" }, { "id": "goGeKQvfo0HY", "label": "10" }, { "id": "QPXIzrZBJqLh", "label": "Entre 11 et 20" }, { "id": "0eENVZNMQH8h", "label": "Plus de 20" } ] }, { "id": "typeform_most_present_parent_id", "ref": "538fd9bd-435b-4634-954a-dd043c44c983", "type": "multiple_choice", "title": "*Qui passe le plus de temps avec **{{field:e9f81869-6960-4f8b-b039-a94c12b2b5cc}}** dans la journ√©e en semaine ?*", "properties": {}, "allow_other_choice": true, "choices": [ { "id": "X3OTdqKzGhi6", "label": "Moi" }, { "id": "szUamCC1wES7", "label": "Plut√¥t l'autre parent" }, { "id": "kMP3acq8PMF4", "label": "Les deux pareil !" }, { "id": "gN78yiVLN8If", "label": "Une assistante maternelle, nourrice" }, { "id": "fi0v4LCTm8UZ", "label": "Le personnel de la cr√®che" }, { "id": "uku3QlRYEpOl", "label": "Un autre membre de la famille" } ] }, { "id": "typeform_other_parent_phone_id", "ref": "80e9d338-af20-400d-91bd-9f7d637b77eb", "type": "short_text", "title": "*Si vous ne l'avez pas d√©j√† fait, vous pouvez nous donner le num√©ro de l'autre parent ici :*", "properties": {} }, { "id": "typeform_degree_id", "ref": "19ea80d8-6409-407f-b28d-e1d3fc1658c6", "type": "multiple_choice", "title": "*Quel est le dernier dipl√¥me que vous avez obtenu ?*", "properties": {}, "allow_other_choice": true, "choices": [ { "id": "FqdeBEgdo49l", "label": "Sans dipl√¥me" }, { "id": "CeVO6QEgAUam", "label": "Brevet" }, { "id": "FnWt3y9OeVej", "label": "BEP ou CAP" }, { "id": "dqiaG4jcp6KJ", "label": "Bac" }, { "id": "T16alGALfs5R", "label": "Bac+1" }, { "id": "piMjOL0qHNFb", "label": "Bac+2" }, { "id": "LtEtvnz3WXye", "label": "Bac+3" }, { "id": "CrxxrsLwGayg", "label": "Bac+4" }, { "id": "FmnhX20wddXo", "label": "Bac+5 et plus" } ] }, { "id": "typeform_degree_in_france_id", "ref": "3a6b26a4-91d0-45bd-8591-2c7878f3a0fb", "type": "multiple_choice", "title": "*Dans quel pays avez-vous obtenu votre dipl√¥me ?*", "properties": {}, "choices": [ { "id": "i7nYJquHdaTO", "label": "France" }, { "id": "UE6TnYWzguH4", "label": "Autre" } ] }, { "id": "typeform_other_parent_degree_id", "ref": "84ca2645-94d5-49d9-8d76-0716a167dc2c", "type": "multiple_choice", "title": "*Quel est le dernier dipl√¥me que l'autre parent a obtenu ?*", "properties": {}, "allow_other_choice": true, "choices": [ { "id": "retKZMPIp8dJ", "label": "Sans dipl√¥me" }, { "id": "NbikGWIwTvug", "label": "Brevet" }, { "id": "ZshskRf5Aqcm", "label": "BEP ou CAP" }, { "id": "7wSU5vXgyYsL", "label": "Bac" }, { "id": "DYyMXx6e6AAu", "label": "Bac+1" }, { "id": "9FHqQLTOSK6S", "label": "Bac+2" }, { "id": "ToVnlDy5Srmj", "label": "Bac+3" }, { "id": "204NK3JuiGfH", "label": "Bac+4" }, { "id": "InUsw7bTEbJS", "label": "Bac+5 et plus" } ] }, { "id": "typeform_other_parent_degree_in_france_id", "ref": "9d784b83-4f4c-4310-ae6c-b7596e7a25e9", "type": "multiple_choice", "title": "*Dans quel pays l'autre parent a-t-il(elle) obtenu son dipl√¥me ?*", "properties": {}, "choices": [ { "id": "qvirwAVfx9Qb", "label": "France" }, { "id": "0KGR4V5Regoz", "label": "Autre" } ] }, { "id": "typeform_reading_frequency_id", "ref": "f133e06f-c46f-43e2-a903-5f696fba8c9f", "type": "multiple_choice", "title": "*La semaine derni√®re, quels jours avez-vous regard√© un livre avec **{{field:e9f81869-6960-4f8b-b039-a94c12b2b5cc}}** ? *üìñ ", "properties": {}, "allow_multiple_selections": true, "choices": [ { "id": "jwSWyDfwiXfh", "label": "Aucun" }, { "id": "7Dk1pOfsOhKX", "label": "Lundi" }, { "id": "h5KKIz3vqktz", "label": "Mardi" }, { "id": "m9BrNlG2kCdJ", "label": "Mercredi" }, { "id": "2oip33EZHOJR", "label": "Jeudi" }, { "id": "rZERvDYpCQho", "label": "Vendredi" }, { "id": "hbItaHjtKKyH", "label": "Samedi" }, { "id": "pXw7mk5sn3LF", "label": "Dimanche" } ] }, { "id": "typeform_tv_frequency_id", "ref": "764d77ef-a8b4-490a-9bcc-31851208391b", "type": "multiple_choice", "title": "*La semaine derni√®re quels jours **{{field:e9f81869-6960-4f8b-b039-a94c12b2b5cc}}** a regard√© la TV ou le t√©l√©phone plus de 5 minutes ?* üì∫üì≥", "properties": {}, "allow_multiple_selections": true, "choices": [ { "id": "opYbV5sVcvKA", "label": "Aucun" }, { "id": "Pqef2GoXYgBs", "label": "Lundi" }, { "id": "asjXiZbPJuyU", "label": "Mardi" }, { "id": "j9WCz5UsPK84", "label": "Mercredi" }, { "id": "HbG4Bz6Dgzoc", "label": "Jeudi" }, { "id": "LMcMehnPCn7P", "label": "Vendredi" }, { "id": "tBZso5BRas8d", "label": "Samedi" }, { "id": "jLa4l0fPsmJ1", "label": "Dimanche" } ] }, { "id": "typeform_is_bilingual_id", "ref": "4d67f3e1-5e72-482e-97e9-d046a383a16f", "type": "multiple_choice", "title": "*Parlez-vous d'autres langues que le fran√ßais avec **{{field:e9f81869-6960-4f8b-b039-a94c12b2b5cc}}** ?*", "properties": {}, "choices": [ { "id": "gpkz3cDa6fYz", "label": "Oui" }, { "id": "cUaDy4om0ZdN", "label": "Non" } ] }, { "id": "typeform_help_my_child_to_learn_id_important_id", "ref": "da960598-66e9-4a86-ae80-d7f492b48878", "type": "multiple_choice", "title": "Aider mon enfant √† apprendre est important pour moi en ce moment", "properties": {}, "choices": [ { "id": "bwYh4RJY9NZN", "label": "D'accord" }, { "id": "pisoc8khZ8Ct", "label": "Pas d'accord" }, { "id": "w3L04oyxeWb7", "label": "Je ne sais pas" } ] }, { "id": "typeform_would_like_to_do_more_id", "ref": "8dcf90e4-1d26-46e6-876f-1fd664eb927d", "type": "multiple_choice", "title": "J'aimerais en faire encore plus pour l'aider √† apprendre", "properties": {}, "choices": [ { "id": "p2ts2CXR7p4y", "label": "D'accord" }, { "id": "oK4qCPCRT1bD", "label": "Pas d'accord" }, { "id": "gdfTWMDHCeqm", "label": "Je ne sais pas" } ] }, { "id": "typeform_would_like_to_receive_advices_id", "ref": "c72278d9-cf0d-4ef9-898b-b744b5a6e979", "type": "multiple_choice", "title": "J'aimerais recevoir des conseils, des id√©es ou de l'aide pour apprendre des choses √† mon enfant", "properties": {}, "choices": [ { "id": "oC48itSLTcNH", "label": "D'accord" }, { "id": "mnjkv2W1aGwg", "label": "Pas d'accord" }, { "id": "QWtMA4TdyBpL", "label": "Je ne sais pas" } ] } ] }, "answers": [ { "type": "text", "text": "Prenom", "field": { "id": "typeform_name_id", "type": "long_text", "ref": "e9f81869-6960-4f8b-b039-a94c12b2b5cc" } }, { "type": "choices", "choices": { "labels": [ "Quand je lui parle", "Quand je lui chante des comptines", "Quand on joue ensemble", "Quand on regarde un livre ensemble" ] }, "field": { "id": "1Oomu9WSahmD", "type": "picture_choice", "ref": "6ffdf209-d13a-42b2-94ce-ab6ac26af5e1" } }, { "type": "choice", "choice": { "label": "2" }, "field": { "id": "typeform_child_count_id", "type": "multiple_choice", "ref": "bdd39145-e370-454e-9431-c08f798122f2" } }, { "type": "choice", "choice": { "label": "Oui" }, "field": { "id": "typeform_already_working_with_id", "type": "multiple_choice", "ref": "7f6ff798-a790-4942-9fc1-ca00add15344" } }, { "type": "choice", "choice": { "label": "2" }, "field": { "id": "typeform_books_quantity_id", "type": "multiple_choice", "ref": "cd2ec817-e02c-4722-aa20-7061133cc9c8" } }, { "type": "choice", "choice": { "label": "Les deux pareil !" }, "field": { "id": "typeform_most_present_parent_id", "type": "multiple_choice", "ref": "538fd9bd-435b-4634-954a-dd043c44c983" } }, { "type": "text", "text": "0677889922", "field": { "id": "typeform_other_parent_phone_id", "type": "short_text", "ref": "80e9d338-af20-400d-91bd-9f7d637b77eb" } }, { "type": "choice", "choice": { "label": "Bac" }, "field": { "id": "typeform_degree_id", "type": "multiple_choice", "ref": "19ea80d8-6409-407f-b28d-e1d3fc1658c6" } }, { "type": "choice", "choice": { "label": "France" }, "field": { "id": "typeform_degree_in_france_id", "type": "multiple_choice", "ref": "3a6b26a4-91d0-45bd-8591-2c7878f3a0fb" } }, { "type": "choice", "choice": { "label": "Bac" }, "field": { "id": "typeform_other_parent_degree_id", "type": "multiple_choice", "ref": "84ca2645-94d5-49d9-8d76-0716a167dc2c" } }, { "type": "choice", "choice": { "label": "Autre" }, "field": { "id": "typeform_other_parent_degree_in_france_id", "type": "multiple_choice", "ref": "9d784b83-4f4c-4310-ae6c-b7596e7a25e9" } }, { "type": "choices", "choices": { "labels": [ "Aucun" ] }, "field": { "id": "typeform_reading_frequency_id", "type": "multiple_choice", "ref": "f133e06f-c46f-43e2-a903-5f696fba8c9f" } }, { "type": "choices", "choices": { "labels": [ "Lundi", "Mardi", "Mercredi" ] }, "field": { "id": "typeform_tv_frequency_id", "type": "multiple_choice", "ref": "764d77ef-a8b4-490a-9bcc-31851208391b" } }, { "type": "choice", "choice": { "label": "Oui" }, "field": { "id": "typeform_is_bilingual_id", "type": "multiple_choice", "ref": "4d67f3e1-5e72-482e-97e9-d046a383a16f" } }, { "type": "choice", "choice": { "label": "D'accord" }, "field": { "id": "typeform_help_my_child_to_learn_id_important_id", "type": "multiple_choice", "ref": "da960598-66e9-4a86-ae80-d7f492b48878" } }, { "type": "choice", "choice": { "label": "D'accord" }, "field": { "id": "typeform_would_like_to_do_more_id", "type": "multiple_choice", "ref": "8dcf90e4-1d26-46e6-876f-1fd664eb927d" } }, { "type": "choice", "choice": { "label": "D'accord" }, "field": { "id": "typeform_would_like_to_receive_advices_id", "type": "multiple_choice", "ref": "c72278d9-cf0d-4ef9-898b-b744b5a6e979" } }, { "type": "choices", "choices": { "ids": [ "Mx9aIY9e4tM8", "krp4H040QdLk" ], "labels": [ "C‚Äôest mon premier enfant.", "Je suis en France depuis moins de 10 ans." ], "refs": [ "2f7e60fe-e468-4780-92cb-12785fb6b113", "f465c57d-655f-4840-a226-9b69e1ceb360" ] }, "field": { "id": "typeform_parental_contexts_id", "type": "multiple_choice", "ref": "ee0235d3-8ba0-4f7f-a98e-cabc0bfea661" } } ] } } }
      Typeform::InitialFormService.new(params[:form_response]).call
      child.child_support.reload
      child.parent1.reload
      expect(child.child_support.important_information).to eq("Nombre d'enfants: 2\n√Ä d√©j√† √©t√© accompagn√© par 1001 mots\nLes deux parents passent le plus de temps avec l'enfant\nAutre num√©ro de t√©l√©phone: +33677889922")
      expect(child.child_support.call1_reading_frequency).to eq("1_rarely")
      expect(child.child_support.books_quantity).to eq("2_three_or_less")
      expect(child.child_support.call1_tv_frequency).to eq("3_frequently")
      expect(child.child_support.most_present_parent).to eq("Les deux parents passent le plus de temps avec l'enfant")
      expect(child.child_support.already_working_with).to eq(true)
      expect(child.child_support.child_count).to eq(2)
      expect(child.parent1.degree).to eq('Bac')
      expect(child.parent1.degree_in_france).to eq(true)
      expect(child.child_support.parental_contexts).to eq(["C‚Äôest mon premier enfant.","Je suis en France depuis moins de 10 ans."])
    end
  end
end
